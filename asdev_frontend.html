<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocol Launcher</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* TERMINAL FIRE THEME */
        body { background-color: #2a1005; color: #ffedd5; font-family: 'Comic Neue', cursive; min-height: 100vh; display: flex; justify-content: center; padding-top: 40px; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        #app-container {
            width: 100%; max-width: 600px;
            background-color: #451a03;
            border: 6px solid #7c2d12;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
        }

        .ticker-wrap { width: 100%; background-color: #2a1005; border-bottom: 2px solid #7c2d12; overflow: hidden; white-space: nowrap; height: 32px; display: flex; align-items: center; }
        .ticker { display: inline-block; padding-left: 100%; animation: marquee 20s linear infinite; font-family: 'JetBrains Mono', monospace; font-size: 12px; color: #fb923c; }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }

        .panel {
            background: rgba(20, 10, 5, 0.6);
            border: 2px solid #ea580c;
            border-radius: 8px;
            box-shadow: 4px 4px 0 #9a3412;
            padding: 24px;
            margin-bottom: 24px;
        }

        .input-field {
            background: #2a1005;
            border: 2px solid #7c2d12;
            color: #fb923c;
            font-family: 'JetBrains Mono', monospace;
            width: 100%;
            padding: 10px;
            margin-bottom: 16px;
            outline: none;
            transition: border-color 0.2s;
        }
        .input-field:focus { border-color: #ea580c; }
        
        .btn-action {
            background: #ea580c; border: 2px solid #9a3412;
            color: #2a1005; font-weight: bold; font-family: 'JetBrains Mono';
            text-transform: uppercase; width: 100%; padding: 14px;
            cursor: pointer; transition: all 0.1s;
            box-shadow: 2px 2px 0 #7c2d12;
        }
        .btn-action:hover { background: #f97316; transform: translate(-1px, -1px); box-shadow: 3px 3px 0 #7c2d12; }
        .btn-action:active { transform: translate(2px, 2px); box-shadow: 0 0 0; }
        .btn-action:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(100%); }

        .status-box {
            background: rgba(0,0,0,0.3); border: 1px solid #ea580c;
            color: #fdba74; padding: 10px; font-size: 12px; font-family: 'JetBrains Mono';
            text-align: center; margin-top: 10px; display: none;
        }
        .status-success { border-color: #22c55e; color: #4ade80; background: rgba(20, 83, 45, 0.3); }
        .status-error { border-color: #ef4444; color: #fca5a5; background: rgba(127, 29, 29, 0.3); }
    </style>
</head>
<body>

<div id="app-container">
    <div class="ticker-wrap"><div class="ticker">INITIALIZING LAUNCH SEQUENCE... PUMP FUN DEPLOYER READY... WAITING FOR INPUT...</div></div>

    <div class="p-6">
        <div class="flex justify-between items-center mb-6 border-b-4 border-orange-900 pb-4">
            <div class="flex items-center gap-3">
                <div class="text-4xl animate-bounce">ðŸ”¥</div>
                <div>
                    <h1 class="text-3xl font-bold text-white">IGNITION</h1>
                    <p class="text-orange-400 text-xs font-mono uppercase">Protocol Launchpad</p>
                </div>
            </div>
            <button id="connect-btn" class="bg-black border border-orange-500 text-orange-500 px-4 py-2 rounded font-mono text-xs hover:bg-orange-900/20">CONNECT WALLET</button>
        </div>

        <div class="panel">
            <h3 class="text-orange-500 font-mono text-sm mb-4 uppercase tracking-widest border-b border-orange-900/50 pb-2">Token Parameters</h3>
            
            <label class="block text-xs text-orange-300 font-mono mb-1">NAME</label>
            <input type="text" id="name" class="input-field" placeholder="e.g. Infernal Coin">

            <label class="block text-xs text-orange-300 font-mono mb-1">TICKER</label>
            <input type="text" id="ticker" class="input-field" placeholder="e.g. BURN">

            <label class="block text-xs text-orange-300 font-mono mb-1">DESCRIPTION</label>
            <textarea id="desc" class="input-field h-24" placeholder="Description of the asset..."></textarea>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs text-orange-300 font-mono mb-1">TWITTER</label>
                    <input type="text" id="twitter" class="input-field" placeholder="Optional">
                </div>
                <div>
                    <label class="block text-xs text-orange-300 font-mono mb-1">WEBSITE</label>
                    <input type="text" id="website" class="input-field" placeholder="Optional">
                </div>
            </div>
        </div>

        <div class="panel bg-orange-900/10">
            <div class="flex justify-between items-center mb-4 font-mono text-xs">
                <span class="text-orange-300">SERVICE FEE</span>
                <span class="text-white font-bold">0.05 SOL</span>
            </div>
            <div class="flex justify-between items-center mb-6 font-mono text-xs">
                <span class="text-orange-300">INITIAL BUY</span>
                <span class="text-green-400 font-bold">0.01 SOL (Auto-Sell)</span>
            </div>
            
            <button id="deploy-btn" class="btn-action">INITIATE LAUNCH</button>
            <div id="status-msg" class="status-box"></div>
        </div>
        
        <div id="result-area" class="panel hidden">
            <h3 class="text-green-400 font-bold font-mono mb-2">DEPLOYMENT SUCCESSFUL</h3>
            <p class="text-xs text-orange-200 font-mono break-all">MINT: <span id="mint-addr" class="text-white"></span></p>
            <a id="tx-link" href="#" target="_blank" class="block mt-4 text-center text-xs font-mono text-blue-400 underline hover:text-blue-300">VIEW TRANSACTION</a>
        </div>

        <div class="text-center text-[10px] font-mono text-orange-900 mt-4">
            SYSTEM STATUS: ONLINE | RPC: HELIUS MAINNET
        </div>
    </div>
</div>

<script>
    // CONFIGURATION
    const BACKEND_URL = "https://asdev-1kvy.onrender.com/api/deploy";
    const DEV_WALLET_PUBKEY = "FNLWHjvjptwC7LxycdK3Knqcv5ptC19C9rynn6u2S1tB";

    let userPubkey = null;
    const connectBtn = document.getElementById('connect-btn');
    const deployBtn = document.getElementById('deploy-btn');
    const statusBox = document.getElementById('status-msg');

    const showStatus = (msg, type) => {
        statusBox.innerText = msg;
        statusBox.style.display = 'block';
        statusBox.className = `status-box ${type === 'error' ? 'status-error' : 'status-success'}`;
    };

    connectBtn.onclick = async () => {
        if (window.solana && window.solana.isPhantom) {
            try {
                const resp = await window.solana.connect();
                userPubkey = resp.publicKey.toString();
                connectBtn.innerText = userPubkey.slice(0, 4) + '...' + userPubkey.slice(-4);
                connectBtn.className = "bg-orange-900/50 border border-orange-700 text-orange-500 px-4 py-2 rounded font-mono text-xs";
            } catch (err) { console.error(err); }
        } else {
            window.open("https://phantom.app/", "_blank");
        }
    };

    deployBtn.onclick = async () => {
        if (!userPubkey) return showStatus("CONNECT WALLET FIRST", 'error');
        
        const name = document.getElementById('name').value;
        const ticker = document.getElementById('ticker').value;
        
        if(!name || !ticker) return showStatus("NAME & TICKER REQUIRED", 'error');

        deployBtn.disabled = true;
        deployBtn.innerText = "PROCESSING PAYMENT...";
        showStatus("SENDING 0.05 SOL FEE...", 'normal');

        try {
            // 1. Send Fee
            const tx = new solanaWeb3.Transaction().add(
                solanaWeb3.SystemProgram.transfer({
                    fromPubkey: new solanaWeb3.PublicKey(userPubkey),
                    toPubkey: new solanaWeb3.PublicKey(DEV_WALLET_PUBKEY),
                    lamports: 0.05 * 1000000000 // 0.05 SOL
                })
            );
            
            const { blockhash } = await window.solana.request({ method: "getLatestBlockhash" });
            tx.recentBlockhash = blockhash;
            tx.feePayer = new solanaWeb3.PublicKey(userPubkey);

            const { signature } = await window.solana.signAndSendTransaction(tx);
            showStatus("PAYMENT SENT. DEPLOYING...", 'normal');

            // 2. Call Backend
            const res = await fetch(BACKEND_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    name, ticker, 
                    description: document.getElementById('desc').value,
                    twitter: document.getElementById('twitter').value,
                    website: document.getElementById('website').value,
                    userTx: signature,
                    userPubkey
                })
            });

            const data = await res.json();

            if (data.success) {
                showStatus("LAUNCH CONFIRMED", 'success');
                document.getElementById('result-area').classList.remove('hidden');
                document.getElementById('mint-addr').innerText = data.mint;
                document.getElementById('tx-link').href = `https://solscan.io/tx/${data.signature}`;
                deployBtn.innerText = "LAUNCHED";
            } else {
                throw new Error(data.error);
            }

        } catch (e) {
            console.error(e);
            showStatus("ERROR: " + e.message, 'error');
            deployBtn.disabled = false;
            deployBtn.innerText = "INITIATE LAUNCH";
        }
    };
</script>

</body>
</html>
