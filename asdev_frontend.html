<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASDev Launcher v10.25.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* TERMINAL FIRE THEME */
        body { background-color: #2a1005; color: #ffedd5; font-family: 'Comic Neue', cursive; min-height: 100vh; display: flex; justify-content: center; align-items: flex-start; padding: 40px 20px; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        #app-container { width: 100%; max-width: 1100px; background-color: #451a03; border: 6px solid #7c2d12; border-radius: 20px; overflow: hidden; box-shadow: 0 40px 80px rgba(0,0,0,0.95); position: relative; }
        .ticker-wrap { width: 100%; background-color: #2a1005; border-bottom: 2px solid #7c2d12; overflow: hidden; height: 40px; display: flex; align-items: center; position: relative; }
        .ticker { display: flex; gap: 2rem; white-space: nowrap; animation: marquee 80s linear infinite; /* Adjusted to 80s (50% slower than 40s) for smoother, visible scrolling */ font-family: 'JetBrains Mono', monospace; font-size: 13px; color: #fb923c; }
        .ticker-item { display: inline-flex; align-items: center; gap: 6px; }
        .ticker-item a { color: #4ade80; text-decoration: underline; transition: color 0.2s; }
        .ticker-item a:hover { color: #ffffff; }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .panel { background: rgba(20, 10, 5, 0.6); border: 2px solid #ea580c; border-radius: 12px; box-shadow: 6px 6px 0 #9a3412; padding: 32px; margin-bottom: 32px; }
        .input-field { background: #2a1005; border: 2px solid #7c2d12; color: #fb923c; font-family: 'JetBrains Mono', monospace; width: 100%; padding: 16px; margin-bottom: 20px; outline: none; transition: border-color 0.2s; border-radius: 6px; font-size: 16px; }
        .input-field:focus { border-color: #ea580c; }
        input[type="file"]::file-selector-button { background: #ea580c; border: none; color: #2a1005; padding: 10px 16px; font-family: 'JetBrains Mono'; font-weight: bold; cursor: pointer; margin-right: 15px; border-radius: 4px; }
        .btn-action { background: #ea580c; border: 2px solid #9a3412; color: #2a1005; font-weight: bold; font-family: 'JetBrains Mono'; text-transform: uppercase; width: 100%; padding: 20px; font-size: 20px; cursor: pointer; transition: all 0.1s; box-shadow: 5px 5px 0 #7c2d12; border-radius: 8px; }
        .btn-action:hover { background: #f97316; transform: translate(-1px, -1px); box-shadow: 6px 6px 0 #7c2d12; }
        .btn-action:active { transform: translate(2px, 2px); box-shadow: 0 0 0; }
        .btn-action:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(100%); transform: none; box-shadow: none; }
        .status-box { background: rgba(0,0,0,0.3); border: 1px solid #ea580c; color: #fdba74; padding: 16px; font-size: 16px; font-family: 'JetBrains Mono'; text-align: center; margin-top: 20px; display: none; border-radius: 6px; }
        .status-success { border-color: #22c55e; color: #4ade80; background: rgba(20, 83, 45, 0.3); }
        .status-error { border-color: #ef4444; color: #fca5a5; background: rgba(127, 29, 29, 0.3); }
        .sys-status { color: #ef4444; font-weight: bold; transition: color 0.5s; }
        .sys-status.online { color: #22c55e; text-shadow: 0 0 8px rgba(34, 197, 94, 0.6); }
        #image-preview { width: 180px; height: 180px; border: 2px dashed #7c2d12; display: flex; align-items: center; justify-content: center; background: #2a1005; color: #7c2d12; font-family: 'JetBrains Mono'; font-size: 12px; overflow: hidden; border-radius: 12px; margin-top: 10px; }
        #image-preview img { width: 100%; height: 100%; object-fit: cover; }
        .log-entry { border-bottom: 1px solid rgba(234, 88, 12, 0.3); padding: 8px 0; font-family: 'JetBrains Mono'; font-size: 12px; display: flex; justify-content: space-between; align-items: center; }
        .log-entry:last-child { border-bottom: none; }
        .log-skipped { color: #fdba74; opacity: 0.8; }
        .log-success { color: #4ade80; font-weight: bold; }
        .log-error { color: #ef4444; }
        .toggle-switch { display: flex; align-items: center; }
        .toggle-switch input { display: none; }
        .toggle-switch .slider { cursor: pointer; width: 60px; height: 34px; background-color: #7c2d12; transition: .4s; border-radius: 34px; position: relative; box-shadow: inset 0 0 4px rgba(0,0,0,0.5); min-width: 60px; }
        .toggle-switch .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        .toggle-switch input:checked + .slider { background-color: #ef4444; } 
        .toggle-switch input:checked + .slider:before { transform: translateX(26px); }
        .mayhem-label { transition: color 0.4s; }
        .mayhem-label.active { color: #ef4444; }
        #header-image { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; animation: bounce 1s infinite alternate; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-5px); } }
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8); }
        .modal-content { background-color: #2a1005; margin: 10% auto; padding: 30px; border: 4px solid #ea580c; width: 80%; max-width: 800px; border-radius: 12px; box-shadow: 0 0 20px rgba(234, 88, 12, 0.5); }
        .close-btn { color: #aaa; float: right; font-size: 28px; font-weight: bold; }
        .close-btn:hover, .close-btn:focus { color: #fff; text-decoration: none; cursor: pointer; }
        .leader-table { width: 100%; border-collapse: collapse; font-family: 'JetBrains Mono', monospace; font-size: 13px; }
        .leader-table th { text-align: left; padding: 10px; border-bottom: 2px solid #ea580c; color: #ea580c; text-transform: uppercase; font-size: 11px; }
        .leader-table td { padding: 12px 10px; border-bottom: 1px solid rgba(234, 88, 12, 0.2); vertical-align: middle; }
        .leader-table tr:hover { background: rgba(234, 88, 12, 0.1); }
        .token-img-sm { width: 32px; height: 32px; border-radius: 4px; object-fit: cover; display: inline-block; vertical-align: middle; margin-right: 8px; border: 1px solid #7c2d12; background-color: #2a1005; min-width: 32px; min-height: 32px; }
        .metric-card { background: rgba(0,0,0,0.2); border: 1px solid #ea580c; padding: 20px; border-radius: 8px; text-align: center; }
        .metric-value { font-size: 24px; font-weight: bold; color: white; font-family: 'JetBrains Mono'; margin-top: 5px; }
        .metric-label { font-size: 12px; color: #fdba74; text-transform: uppercase; letter-spacing: 1px; }
        .holder-check { color: #4ade80; font-weight: bold; margin-left: 8px; display: inline-flex; align-items: center; gap: 2px; font-size: 10px; background: rgba(34, 197, 94, 0.2); padding: 2px 4px; border-radius: 4px; border: 1px solid #22c55e; }
        .badge-bonded { display: inline-block; background-color: #22c55e; color: #000; font-weight: bold; padding: 1px 4px; border-radius: 3px; font-size: 9px; margin-left: 6px; border: 1px solid #14532d; vertical-align: middle; }
        .badge-bonding { display: inline-block; background-color: #eab308; color: #000; font-weight: bold; padding: 1px 4px; border-radius: 3px; font-size: 9px; margin-left: 6px; border: 1px solid #713f12; vertical-align: middle; }
    </style>
</head>
<body>

<div id="app-container">
    <div class="ticker-wrap"><div class="ticker" id="ticker-content"><span class="ticker-item text-orange-600">CONNECTING TO LAUNCH FEED...</span></div></div>

    <div class="p-10">
        <div class="flex justify-between items-start mb-10 border-b-4 border-orange-900 pb-8">
            <div class="flex items-center gap-6">
                <img id="header-image" src="https://placehold.co/60x60/d97706/ffffff?text=LOGO" alt="Project Logo">
                <div><h1 class="text-4xl md:text-5xl font-bold text-white tracking-wide leading-tight">IGNITION</h1><p class="text-orange-400 text-sm font-mono uppercase tracking-widest mt-2">ASDev Airdrop and Flywheel Pumpfun Launcher</p></div>
            </div>
            <div class="flex flex-col items-end gap-3">
                <div id="wallet-ui" class="hidden flex items-center gap-3 bg-orange-950 border border-orange-800 p-3 rounded-lg shadow-xl"><span class="w-3 h-3 rounded-full bg-green-500 animate-pulse"></span><span id="wallet-addr" class="font-mono text-sm text-orange-200"></span><span id="wallet-bal" class="font-mono text-sm text-white font-bold ml-2 bg-orange-900/50 px-3 py-1 rounded">0.00 SOL</span><button id="refresh-btn" class="ml-2 text-orange-400 hover:text-white transition p-1.5 hover:bg-orange-800 rounded"><i data-lucide="refresh-cw" width="16"></i></button><button id="disconnect-btn" class="ml-1 text-red-400 hover:text-red-200 transition p-1.5 hover:bg-red-900/30 rounded"><i data-lucide="log-out" width="16"></i></button></div>
                <button id="connect-btn" class="bg-orange-900/50 border-2 border-orange-700 text-orange-500 px-8 py-3 rounded-lg font-mono text-sm hover:bg-orange-900/80 transition uppercase tracking-wider font-bold shadow-lg hover:shadow-orange-900/40">Connect Wallet</button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
            <div class="panel col-span-1 flex flex-col items-center justify-start h-full">
                <h3 class="text-orange-500 font-mono text-sm mb-6 uppercase tracking-widest w-full text-center border-b-2 border-orange-900/50 pb-3">Token Preview</h3>
                <div class="text-center mb-4 min-h-[60px]"><h2 id="preview-name" class="text-2xl font-bold text-white break-words">Token Name</h2><p id="preview-ticker" class="text-orange-400 font-mono text-lg uppercase">$TICKER</p></div>
                <div id="image-preview" class="mb-6 shadow-2xl shadow-orange-900/30 transition-all duration-300">NO IMAGE</div>
                <input type="file" id="image-file" class="input-field text-sm" accept="image/png, image/jpeg, image/gif" onchange="previewImage(event)"><p class="text-xs text-orange-400 font-mono text-center mt-2">Required: PNG, JPG, GIF.<br>Max size 4MB.</p>
            </div>
            <div class="panel col-span-2">
                <h3 class="text-orange-500 font-mono text-sm mb-6 uppercase tracking-widest border-b-2 border-orange-900/50 pb-3">Token Metadata</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div><label class="block text-sm text-orange-300 font-mono mb-2">NAME <span class="text-red-500">*</span></label><input type="text" id="name" class="input-field" placeholder="e.g. Infernal Coin" maxlength="32" oninput="updatePreview()"></div>
                    <div><label class="block text-sm text-orange-300 font-mono mb-2">TICKER <span class="text-red-500">*</span></label><input type="text" id="ticker" class="input-field" placeholder="e.g. BURN" maxlength="10" oninput="updatePreview()"></div>
                </div>
                <label class="block text-sm text-orange-300 font-mono mb-2">DESCRIPTION</label><textarea id="desc" class="input-field h-32" placeholder="Description of the asset (Max 200 chars)..." maxlength="200"></textarea>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div><label class="block text-sm text-orange-300 font-mono mb-2">TWITTER (OPTIONAL)</label><input type="url" id="twitter" class="input-field" placeholder="https://x.com/username"></div>
                    <div><label class="block text-sm text-orange-300 font-mono mb-2">WEBSITE (OPTIONAL)</label><input type="url" id="website" class="input-field" placeholder="https://project.io"></div>
                </div>
            </div>
        </div>

        <div class="panel bg-gradient-to-r from-orange-950 to-[#2a1005] border-2 border-orange-800 mt-10 lg:col-span-3"> 
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 border-b border-orange-900 pb-4">
                <div class="flex justify-center items-center gap-4 w-full md:w-1/3 order-2 md:order-1 mb-4 md:mb-0">
                    <span class="mayhem-label text-orange-400 text-xs tracking-widest transition-colors duration-300" id="mayhem-status-label">MAYHEM MODE: OFF</span>
                    <label class="toggle-switch"><input type="checkbox" id="mayhem-toggle"><span class="slider"></span></label>
                </div>
                <div class="flex flex-col items-center w-full md:w-1/3 order-1 md:order-2">
                    <span class="text-orange-400 text-xs tracking-widest mb-1">DEPLOYMENT FEE</span>
                    <span class="text-white font-bold text-2xl">0.02 SOL</span>
                </div>
                <div class="w-full md:w-1/3 order-3"><button id="deploy-btn" class="btn-action w-full hover:scale-[1.01] active:scale-[0.99] transition-transform py-3 text-lg">INITIATE LAUNCH SEQUENCE</button></div>
            </div>
            <div class="text-center text-sm text-orange-400 mb-4 pt-2"><span class="font-bold">Mayhem Mode:</span> <span class="text-xs">(Enables Pump.fun's advanced features. Use with caution. Default is Standard Deployment.)</span></div>
            <div id="status-msg" class="status-box"></div>
        </div>
        
        <div class="panel bg-black/30 border border-orange-900 mt-8 lg:col-span-3">
            <div class="flex justify-between items-center border-b border-orange-900/50 pb-2 mb-4">
                <div class="flex items-center gap-4">
                    <h3 class="text-orange-500 font-mono text-sm uppercase tracking-widest">üî• TOP 10 LAUNCHES (BY 24H VOL)</h3>
                    <span id="leaderboard-last-updated" class="text-orange-600 text-xs font-mono">Syncing...</span>
                </div>
                <button onclick="updateLeaderboard()" class="text-orange-400 hover:text-white transition p-1 rounded hover:bg-orange-800" title="Refresh Leaderboard">
                    <i data-lucide="refresh-cw" width="16"></i>
                </button>
            </div>
            <div class="overflow-x-auto">
                <table class="leader-table">
                    <thead><tr><th style="width: 50px;">#</th><th>Token</th><th>Name</th><th class="text-right">MCAP</th><th class="text-right">Vol (24H)</th><th class="text-right">Action</th></tr></thead>
                    <tbody id="leaderboard-body"><tr><td colspan="6" class="text-center text-orange-400 py-4">Scanning Chain Data...</td></tr></tbody>
                </table>
            </div>
        </div>

        <!-- New Airdrop Panel -->
        <div class="panel bg-purple-950/30 border border-purple-800 mt-8 lg:col-span-3">
            <div class="flex justify-between items-center border-b border-purple-800/50 pb-2 mb-4">
                <h3 class="text-purple-400 font-mono text-sm uppercase tracking-widest">ü™Ç AIRDROP RESERVES & POINTS</h3>
                <span class="text-purple-600 text-xs font-mono animate-pulse">LIVE</span>
            </div>
            <div class="flex flex-col md:flex-row items-stretch justify-between gap-6 px-4">
                <!-- Holdings -->
                <div class="text-center w-full md:w-1/3 border-r border-purple-800/30 pr-4">
                    <div class="text-xs text-purple-300 uppercase mb-2 tracking-widest">Dev Wallet Holdings</div>
                    <div class="text-3xl md:text-4xl text-purple-200 font-bold font-mono drop-shadow-[0_0_10px_rgba(168,85,247,0.5)]" id="airdrop-balance">0.00 <span class="text-lg align-top text-purple-400">$PUMP</span></div>
                    <div class="text-sm text-purple-400 font-mono mt-1" id="airdrop-value-sol">‚âà 0.00 SOL</div>
                </div>
                
                <!-- Status -->
                <div class="text-center w-full md:w-1/3 flex flex-col justify-center gap-3 border-r border-purple-800/30 pr-4">
                    <div class="flex justify-between items-center px-4">
                        <span class="text-[10px] text-purple-300 uppercase tracking-widest">Top Holder Pos</span>
                        <span class="text-lg text-yellow-400 font-bold font-mono" id="user-top-positions">0</span>
                    </div>
                    <div class="flex justify-between items-center px-4">
                        <span class="text-[10px] text-purple-300 uppercase tracking-widest">ASDF Top 50</span>
                        <span id="asdf-status" class="text-sm font-bold font-mono text-gray-500">CHECKING...</span>
                    </div>
                </div>

                <!-- Points -->
                <div class="text-center w-full md:w-1/3 flex flex-col justify-center items-center">
                    <div class="text-xs text-purple-300 uppercase mb-1 tracking-widest">Total Points</div>
                    <div class="text-5xl text-white font-bold font-mono drop-shadow-[0_0_15px_rgba(234,179,8,0.6)]" id="user-total-points">0</div>
                    <div id="points-multiplier-badge" class="hidden mt-1 px-2 py-0.5 bg-green-500/20 border border-green-500 rounded text-[10px] text-green-400 font-bold tracking-wider">2X MULTIPLIER ACTIVE</div>
                </div>
            </div>
        </div>

        <div class="panel bg-orange-950/30 border border-orange-900 mt-8 lg:col-span-3">
            <div class="flex justify-between items-center border-b border-orange-900/50 pb-2 mb-4">
                <h3 class="text-orange-500 font-mono text-sm uppercase tracking-widest">BUYBACK & FEE TRACKER</h3>
                <button onclick="toggleLogModal()" class="text-orange-400 hover:text-white transition font-mono text-xs underline p-1">VIEW ALL LOGS</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-center">
                <div class="bg-black/30 p-4 rounded border border-orange-900/50">
                    <div class="text-xs text-orange-400 uppercase">Current Fee Balance</div>
                    <div class="text-xl text-white font-bold font-mono mt-1"><span id="track-balance">0.0000</span> SOL</div>
                </div>
                <div class="bg-black/30 p-4 rounded border border-orange-900/50">
                    <div class="text-xs text-orange-400 uppercase">Last Claim Amount</div>
                    <div class="text-xl text-green-400 font-bold font-mono mt-1"><span id="track-last-amt">0.0000</span> SOL</div>
                </div>
                <div class="bg-black/30 p-4 rounded border border-orange-900/50">
                    <div class="text-xs text-orange-400 uppercase">Last Claim Time</div>
                    <div class="text-sm text-white font-mono mt-2" id="track-last-time">Never</div>
                </div>
                <div class="bg-black/30 p-4 rounded border border-orange-900/50">
                    <div class="text-xs text-orange-400 uppercase">Next Check In</div>
                    <div class="text-xl text-yellow-400 font-bold font-mono mt-1" id="track-next-check">--:--</div>
                </div>
            </div>
        </div>

        <div class="panel bg-orange-900/10 mt-8 lg:col-span-3">
            <h3 class="text-orange-500 font-mono text-sm uppercase tracking-widest border-b border-orange-900/50 pb-2 mb-6">PLATFORM METRICS</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="metric-card"><div class="metric-label">Lifetime Launches</div><div id="metric-launches" class="metric-value">0</div></div>
                <div class="metric-card"><div class="metric-label">$PUMP Tokens Bought</div><div id="metric-pump" class="metric-value">0</div></div>
                <div class="metric-card"><div class="metric-label">Lifetime Fees Processed</div><div id="metric-fees" class="metric-value">0.00</div></div>
            </div>
            <div class="text-center mt-6">
                <button onclick="toggleAboutModal()" class="text-orange-400 hover:text-white font-mono text-xs border border-orange-700 hover:bg-orange-800 px-4 py-2 rounded transition">‚ÑπÔ∏è VIEW FEE & BUYBACK MECHANICS</button>
            </div>
        </div>
        
        <div class="flex justify-between items-center mt-10 text-xs font-mono border-t border-orange-900 pt-6 opacity-70">
            <div><span class="text-orange-600">RPC UPLINK: MAINNET PUBLIC</span></div>
            <div class="flex gap-4"><span>SYSTEM STATUS: <span id="sys-status" class="sys-status">OFFLINE</span></span><span id="version-display" class="text-orange-500 font-bold">v...</span></div>
        </div>
    </div>
</div>

<div id="log-modal" class="modal"><div class="modal-content"><span class="close-btn" onclick="closeLogModal()">&times;</span><h3 class="text-orange-500 font-mono text-lg mb-4 uppercase tracking-widest border-b border-orange-900/50 pb-2">FULL BUYBACK LOGS</h3><div id="modal-log-content" class="max-h-[60vh] overflow-y-auto pr-2"></div></div></div>

<div id="about-modal" class="modal"><div class="modal-content"><span class="close-btn" onclick="closeAboutModal()">&times;</span><h3 class="text-orange-500 font-mono text-lg mb-4 uppercase tracking-widest border-b border-orange-900/50 pb-2">FEE & BUYBACK MECHANICS</h3>
    <div id="about-content-static">
        <p class="text-orange-200 text-sm leading-relaxed font-sans mb-4">The platform implements an automated flywheel mechanism designed for ecosystem stability and growth, funded by the mandatory <span class="text-white font-mono">0.02 SOL</span> deployment fee. This fee is automatically added to a reserve pool.</p>
        <h4 class="text-white text-base mb-2">Autoclaim & Distribution Breakdown (Every 5 Minutes, Threshold: 0.20 SOL)</h4>
        <ul class="list-disc list-inside text-orange-300 text-sm font-mono space-y-2">
            <li><span class="text-green-400 font-bold">90.0%</span>: Utilized for immediate buyback of the **$PUMP** token (Contract: `pumpCmXqMfrsAkQ5r49WcJnRayYRqmXz6ae8H7H9Dfn`), **accumulating for airdrops**.</li>
            <li><span class="text-red-400 font-bold">9.5%</span>: **Sent to the Fee Wallet for Buybacks and Burns of $ASDFASDFA**.</li>
            <li><span class="text-red-400 font-bold">0.5%</span>: **Upkeep Fee**.</li>
            <li><span class="text-yellow-400">STATUS</span>: The distribution is only executed when the accumulated fee pool reaches or exceeds **0.20 SOL**. Rounds are skipped if the threshold is not met.</li>
        </ul>
        <div class="mt-6 p-4 border border-orange-800 bg-orange-950/50 rounded-lg">
            <h5 class="text-red-400 font-bold mb-2">LEGAL DISCLAIMER</h5>
            <p class="text-xs text-orange-300">This platform is a decentralized utility tool provided "as-is". The operators are not responsible for the nature of tokens created, their value, or any financial losses incurred. By using this service, you agree to comply with all applicable laws and regulations in your jurisdiction. Uploading illegal or prohibited content is strictly forbidden and will be blocked by automated AI moderation systems. Transactions on the blockchain are irreversible.</p>
        </div>
    </div>
</div></div>

<!-- Success Modal -->
<div id="success-modal" class="modal" style="display: none;">
    <div class="modal-content text-center border-green-600 bg-green-950/90 relative">
        <span class="close-btn absolute top-2 right-4 text-green-400 hover:text-white" onclick="closeSuccessModal()">&times;</span>
        <div class="mb-6"><i data-lucide="rocket" class="w-16 h-16 text-green-400 mx-auto animate-bounce"></i></div>
        <h3 class="text-green-400 font-bold font-mono mb-2 text-3xl tracking-widest">DEPLOYMENT SUCCESSFUL</h3>
        <p class="text-green-200 text-sm mb-6">Your token is live on the Solana blockchain!</p>
        
        <div class="bg-black/40 p-4 rounded-lg border border-green-800 mb-6 text-left">
            <p class="text-xs text-green-500 font-mono uppercase tracking-wider mb-1">MINT ADDRESS</p>
            <p id="modal-mint-addr" class="text-white font-mono text-lg break-all font-bold select-all"></p>
        </div>
        
        <a id="modal-tx-link" href="#" target="_blank" class="block w-full text-center text-base font-mono text-black bg-green-500 hover:bg-green-400 py-3 rounded-lg font-bold transition shadow-lg hover:shadow-green-500/20 mb-4">
            VIEW TRANSACTION ON SOLSCAN
        </a>
        <button onclick="closeSuccessModal()" class="block w-full text-center text-sm font-mono text-green-400 border border-green-800 hover:bg-green-900/50 py-2 rounded-lg transition">
            CLOSE & LAUNCH ANOTHER
        </button>
    </div>
</div>

<script>
    const FRONTEND_VERSION = "v10.25.1";
    const BACKEND_URL = "https://asdev-1kvy.onrender.com"; 
    const DEV_WALLET_PUBKEY = "FNLWHjvjptwC7LxycdK3Knqcv5ptC19C9rynn6u2S1tB";
    const DEPLOYMENT_FEE = 0.02; 
    const PUMPFUN_URL_BASE = "https://pump.fun/coin/";
    const PUMP_CONTRACT = "pumpCmXqMfrsAkQ5r49WcJnRayYRqmXz6ae8H7H9Dfn";

    let userPubkey = null;
    let allLogs = []; 
    let pumpPriceCache = 0.0;
    let isDeploying = false;
    let nextCheckTime = 0;

    const ui = {
        connectBtn: document.getElementById('connect-btn'), walletUI: document.getElementById('wallet-ui'), walletAddr: document.getElementById('wallet-addr'), walletBal: document.getElementById('wallet-bal'),
        refreshBtn: document.getElementById('refresh-btn'), disconnectBtn: document.getElementById('disconnect-btn'), deployBtn: document.getElementById('deploy-btn'),
        statusBox: document.getElementById('status-msg'), sysStatus: document.getElementById('sys-status'), imgPreview: document.getElementById('image-preview'),
        previewName: document.getElementById('preview-name'), previewTicker: document.getElementById('preview-ticker'), lifetimeFees: document.getElementById('lifetime-fees'),
        logFeed: document.getElementById('log-feed'), headerImage: document.getElementById('header-image'), mayhemToggle: document.getElementById('mayhem-toggle'),
        mayhemStatusLabel: document.getElementById('mayhem-status-label'), logModal: document.getElementById('log-modal'), modalLogContent: document.getElementById('modal-log-content'),
        aboutModal: document.getElementById('about-modal'), successModal: document.getElementById('success-modal'),
        tickerContent: document.getElementById('ticker-content'), leaderboardBody: document.getElementById('leaderboard-body'), versionDisplay: document.getElementById('version-display'),
        metricLaunches: document.getElementById('metric-launches'), metricPump: document.getElementById('metric-pump'), metricFees: document.getElementById('metric-fees'),
        trackBalance: document.getElementById('track-balance'), trackLastAmt: document.getElementById('track-last-amt'), trackLastTime: document.getElementById('track-last-time'), trackNextCheck: document.getElementById('track-next-check'),
        leaderboardLastUpdated: document.getElementById('leaderboard-last-updated'),
        airdropBalance: document.getElementById('airdrop-balance'), airdropValueSol: document.getElementById('airdrop-value-sol'),
        userTopPositions: document.getElementById('user-top-positions'), asdfStatus: document.getElementById('asdf-status'),
        userTotalPoints: document.getElementById('user-total-points'), pointsMultiplierBadge: document.getElementById('points-multiplier-badge')
    };

    lucide.createIcons();

    fetch(`${BACKEND_URL}/api/version`).then(r=>r.json()).then(d=>ui.versionDisplay.innerText = `${FRONTEND_VERSION} | BE: ${d.version}`).catch(()=>{});

    // Simple number formatter for MCAP (e.g., 12.5K, 1.2M)
    const formatMcap = (num) => {
        if (!num || num === 0) return "$0";
        if (num >= 1000000) return "$" + (num / 1000000).toFixed(2) + "M";
        if (num >= 1000) return "$" + (num / 1000).toFixed(1) + "K";
        return "$" + num.toLocaleString();
    };

    const updatePumpPrice = async () => {
        try {
            const res = await fetch(`https://frontend-api.pump.fun/coins/${PUMP_CONTRACT}`);
            const data = await res.json();
            if (data && data.virtual_sol_reserves && data.virtual_token_reserves) {
                pumpPriceCache = data.virtual_sol_reserves / data.virtual_token_reserves;
            }
        } catch (e) {}
    };

    const updateLeaderboard = async () => {
        try {
            const endpoint = `${BACKEND_URL}/api/leaderboard${userPubkey ? '?userPubkey='+userPubkey : ''}`;
            const res = await fetch(endpoint);
            const data = await res.json();
            
            // Handle the structured response from updated backend
            const tokens = data.tokens || [];
            const lastUpdate = data.lastUpdate;

            if (lastUpdate) {
                 const backendTime = new Date(lastUpdate).toLocaleTimeString();
                 ui.leaderboardLastUpdated.innerText = `Synced: ${backendTime}`;
            } else {
                 ui.leaderboardLastUpdated.innerText = `Synced: ${new Date().toLocaleTimeString()}`;
            }

            if (!tokens || tokens.length === 0) { ui.leaderboardBody.innerHTML = '<tr><td colspan="6" class="text-center text-orange-400 py-4">No active tokens found.</td></tr>'; return; }
            ui.leaderboardBody.innerHTML = await Promise.all(tokens.map(async (item, index) => {
                let displayMcap = item.marketCap; // Default from backend (Pump API)
                let displayVol = parseFloat(item.volume);
                
                let tradeLink = `${PUMPFUN_URL_BASE}${item.mint}`;
                let badge = `<span class="badge-bonding" title="Bonding in Progress">PRE-BOND</span>`; 

                // If complete (Post-Bond), attempt to fetch real data from DexScreener
                if (item.complete) {
                    badge = `<span class="badge-bonded" title="Bonding Curve Complete">BONDED</span>`;
                    tradeLink = `${PUMPFUN_URL_BASE}${item.mint}`; 
                    try {
                        const dexRes = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${item.mint}`);
                        const dexData = await dexRes.json();
                        if (dexData.pairs && dexData.pairs.length > 0) {
                            const pair = dexData.pairs[0];
                            if (pair.fdv) displayMcap = pair.fdv;
                            else if (pair.marketCap) displayMcap = pair.marketCap;
                            displayVol = pair.volume.h24;
                        }
                    } catch (e) { console.error("DEX fetch failed", e); }
                }

                let imgSrc = item.image;
                if ((!imgSrc || imgSrc.trim() === '') && item.metadataUri) {
                    try {
                        const metaRes = await fetch(item.metadataUri);
                        const metaJson = await metaRes.json();
                        if (metaJson.image) {
                            imgSrc = metaJson.image;
                        }
                    } catch (e) { console.error("Metadata fetch failed", e); }
                }
                
                if (!imgSrc || imgSrc.trim() === '') {
                    imgSrc = 'https://placehold.co/32x32/333/fff?text=?'; 
                }

                const holderMark = item.isUserTopHolder 
                    ? `<span class="holder-check" title="You are a Top Holder">üëë TOP HOLDER</span>` 
                    : '';
                
                return `
                <tr>
                    <td class="text-orange-500 font-bold">${index + 1}</td>
                    <td>
                        <img src="${imgSrc}" onerror="this.src='https://placehold.co/32x32/333/fff?text=?'" class="token-img-sm" alt="icon">
                        <span class="text-white font-bold">${item.ticker}</span>
                        ${holderMark}
                        ${badge}
                    </td>
                    <td class="text-orange-200 truncate max-w-[100px]">${item.name}</td>
                    <td class="text-right text-green-400 font-bold font-mono">${formatMcap(displayMcap)}</td>
                    <td class="text-right text-white font-bold">$${displayVol.toLocaleString()}</td>
                    <td class="text-right"><a href="${tradeLink}" target="_blank" class="text-xs bg-orange-900/50 border border-orange-700 text-orange-300 px-2 py-1 rounded hover:bg-orange-800 hover:text-white transition">TRADE</a></td>
                </tr>`;
            })).then(rows => rows.join(''));

        } catch (e) {}
    };
    window.updateLeaderboard = updateLeaderboard;

    const checkAsdfStatus = async () => {
        if (!userPubkey) {
            ui.asdfStatus.innerText = "NOT CONNECTED";
            ui.asdfStatus.className = "text-sm font-bold font-mono text-gray-500";
            ui.userTopPositions.innerText = "0";
            ui.userTotalPoints.innerText = "0";
            ui.pointsMultiplierBadge.classList.add('hidden');
            return;
        }
        
        ui.asdfStatus.innerText = "CHECKING...";
        try {
            const res = await fetch(`${BACKEND_URL}/api/check-holder?userPubkey=${userPubkey}`);
            const data = await res.json();
            
            // Update Top Position Count (Base Points)
            ui.userTopPositions.innerText = data.heldPositionsCount || 0;

            // Update ASDF Status
            if (data.isAsdfTop50) {
                ui.asdfStatus.innerText = "YES (QUALIFIED)";
                ui.asdfStatus.className = "text-sm font-bold font-mono text-green-400 animate-pulse";
                ui.pointsMultiplierBadge.classList.remove('hidden');
            } else {
                ui.asdfStatus.innerText = "NO";
                ui.asdfStatus.className = "text-sm font-bold font-mono text-red-400";
                ui.pointsMultiplierBadge.classList.add('hidden');
            }

            // Update Total Points
            ui.userTotalPoints.innerText = data.points || 0;

        } catch (e) {
            console.error("ASDF/Points Check Error", e);
            ui.asdfStatus.innerText = "ERROR";
        }
    };

    const fetchRecentLaunches = async () => { 
        // Explicitly set fetching status right before network call
        ui.tickerContent.innerHTML = '<span class="ticker-item text-orange-600">FETCHING LAUNCH FEED... PLEASE WAIT...</span>';

        try { 
            const res = await fetch(`${BACKEND_URL}/api/recent-launches`); 
            if (res.ok) { 
                const launches = await res.json(); 
                if (launches.length === 0) { 
                    ui.tickerContent.innerHTML = '<span class="ticker-item text-orange-600">NO RECENT LAUNCHES YET... START ONE!</span>'; 
                    return; 
                } 
                const repeatedLaunches = Array(5).fill(launches).flat(); 
                const tickerItems = repeatedLaunches.map(launch => `<span class="ticker-item"><span class="text-white font-bold">LAUNCHED:</span><span class="text-white">${launch.userSnippet}...</span><span class="text-orange-400">-></span><a href="${PUMPFUN_URL_BASE}${launch.mint}" target="_blank" class="font-bold underline">${launch.ticker}</a></span>`).join(''); 
                ui.tickerContent.innerHTML = tickerItems; 
            } else {
                // Server returned non-200 status
                 ui.tickerContent.innerHTML = '<span class="ticker-item text-red-500">ERROR: FAILED TO LOAD LAUNCH FEED (Server Issue)</span>'; 
            }
        } catch (e) {
            // Network error/timeout
            ui.tickerContent.innerHTML = '<span class="ticker-item text-red-500">ERROR: FAILED TO LOAD LAUNCH FEED (Network Error)</span>';
        } 
    };

    const checkHealth = async () => { 
        try { 
            const res = await fetch(`${BACKEND_URL}/api/health`); 
            if (res.ok) { 
                const data = await res.json(); 
                ui.sysStatus.innerText = "ONLINE"; ui.sysStatus.classList.add("online"); 
                ui.headerImage.src = data.headerImageUrl || "https://placehold.co/60x60/d97706/ffffff?text=LOGO"; 
                if (data.lifetimeFees) ui.metricFees.innerText = data.lifetimeFees; 
                if (data.totalLaunches) ui.metricLaunches.innerText = data.totalLaunches; 
                const solSpent = parseFloat(data.totalPumpBought || 0);
                let tokensBought = "0";
                if (pumpPriceCache > 0) { tokensBought = (solSpent / pumpPriceCache).toLocaleString('en-US', {maximumFractionDigits: 0}); } 
                else { tokensBought = (solSpent * 30000000).toLocaleString('en-US', {maximumFractionDigits: 0}); }
                ui.metricPump.innerText = tokensBought;
                allLogs = data.recentLogs; 
                
                if (data.currentFeeBalance) ui.trackBalance.innerText = data.currentFeeBalance;
                if (data.lastClaimAmount) ui.trackLastAmt.innerText = data.lastClaimAmount;
                if (data.lastClaimTime && data.lastClaimTime > 0) {
                    ui.trackLastTime.innerText = new Date(data.lastClaimTime).toLocaleString();
                } else {
                    ui.trackLastTime.innerText = "Never";
                }
                
                if (data.nextCheckTime) {
                    nextCheckTime = data.nextCheckTime;
                }

                // NEW: Update Airdrop Panel
                if (data.pumpHoldings !== undefined) {
                    ui.airdropBalance.innerHTML = `${parseFloat(data.pumpHoldings).toLocaleString('en-US', {maximumFractionDigits: 0})} <span class="text-lg align-top text-purple-400">$PUMP</span>`;
                    const estVal = data.pumpHoldings * pumpPriceCache;
                    ui.airdropValueSol.innerText = `‚âà ${estVal.toFixed(2)} SOL`;
                }

            } else { throw new Error("Backend Error"); } 
        } catch (e) { ui.sysStatus.innerText = "OFFLINE"; ui.sysStatus.classList.remove("online"); ui.headerImage.src = "https://placehold.co/60x60/d97706/ffffff?text=LOGO"; } 
    };

    setInterval(() => {
        if (nextCheckTime > 0) {
            const now = Date.now();
            const diff = nextCheckTime - now;
            if (diff > 0) {
                const min = Math.floor(diff / 60000);
                const sec = Math.floor((diff % 60000) / 1000);
                ui.trackNextCheck.innerText = `${min}:${sec < 10 ? '0' + sec : sec}`;
            } else {
                if (diff > -10000) ui.trackNextCheck.innerText = "Checking...";
                else ui.trackNextCheck.innerText = "Wait..."; 
            }
        }
    }, 1000);

    const refreshWalletBalance = async () => { 
        if (!userPubkey) return; 
        try { 
            const res = await fetch(`${BACKEND_URL}/api/balance?pubkey=${userPubkey}`);
            if (!res.ok) throw new Error("Balance fetch failed");
            const data = await res.json();
            const solBalance = data.balance / solanaWeb3.LAMPORTS_PER_SOL;
            ui.walletBal.innerText = solBalance.toFixed(3) + " SOL"; 
            if (!isDeploying) {
                if (solBalance < DEPLOYMENT_FEE) {
                    ui.deployBtn.disabled = true; ui.deployBtn.innerText = `INSUFFICIENT BALANCE (< ${DEPLOYMENT_FEE} SOL)`; ui.deployBtn.classList.add("opacity-50", "cursor-not-allowed");
                } else {
                    ui.deployBtn.disabled = false; ui.deployBtn.innerText = "INITIATE LAUNCH SEQUENCE"; ui.deployBtn.classList.remove("opacity-50", "cursor-not-allowed");
                }
            }
        } catch (e) { console.error("Balance check error:", e); } 
    };

    const refreshAllData = async () => {
        if (ui.refreshBtn) ui.refreshBtn.classList.add('opacity-50', 'cursor-wait');
        try {
            await Promise.allSettled([
                updatePumpPrice(),
                updateLeaderboard(),
                fetchRecentLaunches(),
                checkHealth(),
                refreshWalletBalance()
            ]);
        } catch (e) { console.error("Auto-Refresh Error", e); }
        if (ui.refreshBtn) ui.refreshBtn.classList.remove('opacity-50', 'cursor-wait');
    };
    window.refreshAllData = refreshAllData;

    setInterval(refreshAllData, 60000);
    refreshAllData();

    ui.refreshBtn.onclick = () => refreshAllData();

    const updateMayhemLabel = () => { if (ui.mayhemToggle.checked) { ui.mayhemStatusLabel.innerText = "MAYHEM MODE: ON (HIGH RISK)"; ui.mayhemStatusLabel.classList.add('active'); } else { ui.mayhemStatusLabel.innerText = "MAYHEM MODE: OFF"; ui.mayhemStatusLabel.classList.remove('active'); } };
    ui.mayhemToggle.addEventListener('change', updateMayhemLabel); updateMayhemLabel(); 

    const updatePreview = () => { ui.previewName.innerText = document.getElementById('name').value || "Token Name"; ui.previewTicker.innerText = document.getElementById('ticker').value ? `$${document.getElementById('ticker').value.toUpperCase()}` : "$TICKER"; };
    const previewImage = (event) => { const file = event.target.files[0]; if (file) { const reader = new FileReader(); reader.onload = (e) => { ui.imgPreview.innerHTML = `<img src="${e.target.result}" alt="Preview" class="rounded-lg w-full h-full object-cover">`; ui.imgPreview.style.border = "2px solid #ea580c"; }; reader.readAsDataURL(file); } else { ui.imgPreview.innerHTML = "NO IMAGE"; ui.imgPreview.style.border = "2px dashed #7c2d12"; } };
    window.previewImage = previewImage; window.updatePreview = updatePreview;

    const closeSuccessModal = () => { ui.successModal.style.display = 'none'; };
    window.closeSuccessModal = closeSuccessModal;

    const toggleLogModal = () => { ui.modalLogContent.innerHTML = ''; 
        if(allLogs && allLogs.length > 0) {
            ui.modalLogContent.innerHTML = allLogs.map(log => {
                const time = new Date(log.timestamp).toLocaleTimeString();
                return `<div class="log-entry text-orange-300"><span>[${time}] ${log.type}:</span> <span>${JSON.stringify(log.data || log)}</span></div>`;
            }).join('');
        } else {
            ui.modalLogContent.innerHTML = '<p class="text-center text-orange-400">No logs yet.</p>';
        }
        ui.logModal.style.display = 'block'; 
    };
    window.toggleLogModal = toggleLogModal;
    const closeLogModal = () => { ui.logModal.style.display = 'none'; };
    window.closeLogModal = closeLogModal;

    const toggleAboutModal = () => { ui.aboutModal.style.display = 'block'; };
    window.toggleAboutModal = toggleAboutModal;
    const closeAboutModal = () => { ui.aboutModal.style.display = 'none'; };
    window.closeAboutModal = closeAboutModal;

    const showStatus = (msg, type) => { ui.statusBox.innerText = msg; ui.statusBox.style.display = 'block'; if (type === 'error') ui.statusBox.className = 'status-box status-error'; else if (type === 'success') ui.statusBox.className = 'status-box status-success'; else ui.statusBox.className = 'status-box'; };
    const toBase64 = file => new Promise((resolve, reject) => { const reader = new FileReader(); reader.readAsDataURL(file); reader.onload = () => resolve(reader.result); reader.onerror = error => reject(error); });

    const updateWalletUI = async (pubkey) => {
        if (!pubkey) {
            ui.walletUI.classList.add('hidden');
            ui.connectBtn.classList.remove('hidden');
            updateLeaderboard(); // Update to remove user-specific data on disconnect
            checkAsdfStatus(); // Reset status display
            return;
        }
        userPubkey = pubkey.toString();
        ui.connectBtn.classList.add('hidden');
        ui.walletUI.classList.remove('hidden');
        ui.walletUI.classList.add('flex');
        ui.walletAddr.innerText = userPubkey.slice(0, 4) + '...' + userPubkey.slice(-4);
        await refreshWalletBalance();
        updateLeaderboard(); // Update to show user-specific data on connect
        checkAsdfStatus();
    };

    const connectWallet = async () => { if (window.solana && window.solana.isPhantom) { try { const resp = await window.solana.connect(); await updateWalletUI(resp.publicKey); } catch (err) { console.error(err); } } else { window.open("https://phantom.app/", "_blank"); } };
    const disconnectWallet = async () => { if (window.solana) { try { await window.solana.disconnect(); } catch (e) {} userPubkey = null; updateWalletUI(null); } };
    ui.connectBtn.onclick = connectWallet; ui.disconnectBtn.onclick = disconnectWallet;

    const validateInputs = (name, ticker, description, twitter, website, fileInput) => {
        if (fileInput.files.length === 0) return "Image is required.";
        const file = fileInput.files[0];
        if (file.size > 4 * 1024 * 1024) return "Image size must be less than 4MB.";
        if (!name || name.trim().length === 0) return "Token Name is required.";
        if (name.length > 32) return "Token Name must be 32 characters or less.";
        if (!ticker || ticker.trim().length === 0) return "Ticker Symbol is required.";
        if (ticker.length > 10) return "Ticker must be 10 characters or less.";
        if (description.length > 200) return "Description must be 200 characters or less.";
        const urlPattern = /^(https?:\/\/[^\s]+|([a-zA-Z0-9-]+\.)+[a-zA-Z]{2,}(\/[^\s]*)?)$/;
        if (twitter && twitter.trim() !== '' && !urlPattern.test(twitter)) return "Invalid Twitter URL.";
        if (website && website.trim() !== '' && !urlPattern.test(website)) return "Invalid Website URL.";
        return null;
    };

    ui.deployBtn.onclick = async () => {
        if (!userPubkey) return showStatus("CONNECT WALLET FIRST", 'error');
        const name = document.getElementById('name').value;
        const ticker = document.getElementById('ticker').value;
        const description = document.getElementById('desc').value;
        const twitter = document.getElementById('twitter').value;
        const website = document.getElementById('website').value;
        const fileInput = document.getElementById('image-file');
        const isMayhemMode = ui.mayhemToggle.checked;
        
        const validationError = validateInputs(name, ticker, description, twitter, website, fileInput);
        if (validationError) return showStatus(validationError.toUpperCase(), 'error');

        let imageBase64;
        try { imageBase64 = await toBase64(fileInput.files[0]); } catch(e) { return showStatus("IMAGE PROCESSING FAILED", 'error'); }

        isDeploying = true; // Lock button
        ui.deployBtn.disabled = true; 
        ui.deployBtn.innerText = "UPLOADING & VERIFYING METADATA..."; 
        showStatus("PREPARING METADATA...", 'normal');

        try {
            const prepRes = await fetch(`${BACKEND_URL}/api/prepare-metadata`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, ticker, description, twitter, website, image: imageBase64 })
            });
            
            if (!prepRes.ok) {
                const errData = await prepRes.json();
                throw new Error(errData.error || "Metadata upload failed");
            }
            const { metadataUri } = await prepRes.json();
            
            ui.deployBtn.innerText = "SIGNING FEE TRANSACTION...";
            showStatus("METADATA READY. PLEASE SIGN WALLET...", 'normal');

            const bhRes = await fetch(`${BACKEND_URL}/api/blockhash`);
            if (!bhRes.ok) throw new Error("Failed to fetch blockhash from backend");
            const { blockhash } = await bhRes.json();

            const tx = new solanaWeb3.Transaction();
            const modifyComputeUnits = solanaWeb3.ComputeBudgetProgram.setComputeUnitLimit({ units: 200000 });
            const addPriorityFee = solanaWeb3.ComputeBudgetProgram.setComputeUnitPrice({ microLamports: 100000 });
            tx.add(modifyComputeUnits);
            tx.add(addPriorityFee);

            tx.add(
                solanaWeb3.SystemProgram.transfer({
                    fromPubkey: new solanaWeb3.PublicKey(userPubkey),
                    toPubkey: new solanaWeb3.PublicKey(DEV_WALLET_PUBKEY),
                    lamports: DEPLOYMENT_FEE * 1000000000 
                })
            );
            
            tx.recentBlockhash = blockhash;
            tx.feePayer = new solanaWeb3.PublicKey(userPubkey);
            
            const signedTx = await window.solana.signAndSendTransaction(tx);
            
            ui.deployBtn.innerText = "QUEUING DEPLOYMENT...";
            showStatus("PAYMENT CONFIRMED. QUEUING...", 'normal');

            const deployRes = await fetch(`${BACKEND_URL}/api/deploy`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    name, ticker, description, twitter, website,
                    metadataUri,
                    userTx: signedTx.signature,
                    userPubkey: userPubkey,
                    isMayhemMode: isMayhemMode 
                })
            });

            const data = await deployRes.json();
            if (data.success && data.jobId) {
                ui.deployBtn.innerText = "DEPLOYING...";
                pollJobStatus(data.jobId);
            } else { throw new Error(data.error); }

        } catch (e) {
            console.error(e);
            showStatus("ERROR: " + (e.message || "Process failed."), 'error');
            isDeploying = false; // Unlock button logic
            refreshWalletBalance(); // Reset button state
        }
    };

    const pollJobStatus = async (jobId) => {
        const interval = setInterval(async () => {
            try {
                const res = await fetch(`${BACKEND_URL}/api/job-status/${jobId}`);
                const job = await res.json();
                
                if (job.state === 'completed') {
                    clearInterval(interval);
                    showStatus("LAUNCH CONFIRMED", 'success');
                    const mintAddr = job.result.mint;
                    const txSig = job.result.signature;
                    document.getElementById('modal-mint-addr').innerText = mintAddr;
                    document.getElementById('modal-tx-link').href = `https://solscan.io/tx/${txSig}`;
                    ui.successModal.style.display = 'block';
                    ui.deployBtn.innerText = "LAUNCH COMPLETE"; ui.deployBtn.disabled = false;
                    isDeploying = false;
                    refreshAllData();
                } else if (job.state === 'failed') {
                    clearInterval(interval);
                    showStatus(`DEPLOYMENT FAILED: ${job.failedReason}`, 'error');
                    isDeploying = false;
                    ui.deployBtn.disabled = false; ui.deployBtn.innerText = "RETRY LAUNCH";
                } else {
                    showStatus(`STATUS: ${job.state.toUpperCase()} (Please Wait...)`, 'normal');
                }
            } catch (e) { console.error("Polling error", e); }
        }, 2000); // Check every 2s
    };
    
    window.addEventListener('load', () => {
        if (window.solana && window.solana.isPhantom) {
            window.solana.connect({ onlyIfTrusted: true }).then((resp) => updateWalletUI(resp.publicKey)).catch(() => {});
            window.solana.on('disconnect', () => { disconnectWallet(); showStatus("Wallet Disconnected.", 'info'); });
        }
    });
</script>

</body>
</html>
